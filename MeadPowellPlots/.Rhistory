dfMeadPoolsPlot2 <- dfMeadPoolsPlot
dfMeadPoolsPlot2[9,8] <- "1192 - Max. Req. Flood Pool"
dfMeadPoolsPlot2[10,8] <- "1218 - Min. Req. Flood Pool"
#Create the month ticks
cMonths <- 1:12
cMonthsLabels <- month.abb[cMonths]
ggplot() +
geom_line(data=dfPlotData,aes(x=Month,y=stor_maf, color = name), size=2) +
scale_color_manual(values = palBlues[10:-1:2]) +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#scale_fill_manual(values = palBlues[7:-1:2]) +
geom_line(data=dfFloodPoolsMelt,aes(x=month_num, y=value, group = variable), size=1) +
#Label the flood pool contours of empty upstream storage
geom_label(data=dfFloodPoolsMelt %>% filter(month_num %in% c(3,11)), aes( x = month_num, y = value, label = variable, fontface="bold"), size=5, angle = 0) +
geom_label(aes( x = 7, y = 23, label = "[MAF of empty upstream storage]", fontface="bold"), label.size = 0, size=5, angle = 0) +
#Label the levels within the equalization tiers
#geom_text(data=dfReleases, aes( x = MidPowell, y = MidMead, label = Release), angle = 0, size = 6) +
#Create secondary axes for Lake Levels
# Can't figure out why dfMeadTiers$Volume does not work!!!! Hard coding ...
#ylim(0,dfPlotData[1,c("stor_maf")]+1) +
#scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = LevelsAsTicks$stor_maf, labels = round(LevelsAsTicks$level,1))) +
scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Elevation (feet)", breaks = dfMeadPoolsPlot2$stor_maf, labels = dfMeadPoolsPlot2$label)) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
scale_x_continuous(breaks=cMonths, labels= cMonthsLabels) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Active Storage (MAF)", fill = "Pool") +
theme(text = element_text(size=20), legend.title=element_blank(),
legend.text=element_text(size=18), legend.position = "none",
axis.text.x = element_text(size=18))
ggsave("MeadPools.png", width=9, height = 6.5, units="in")
##### #4. Plot POWELL Pool Levels including Flood storage as a function of upstream storage
# Prepare data for Lower and Mid equalization tiers
dfPowellTiersAsPools <- dfPowellTiers[,c("Tier","PowellLowerVol")]
colnames(dfPowellTiersAsPools) <- c("variable","PowellLowerVol")
dfPowellTiersAsPools$stor_maf <- 0;
dfPowellTiersAsPools <- mutate(dfPowellTiersAsPools, stor_maf = lead(PowellLowerVol))
dfPowellTiersAsPools$Reservoir <- 'Powell'
dfPowellTiersAsPools$value <- dfPowellTiersAsPools$stor_maf*1000000
dfPowellTiersAsPools <- dfPowellTiersAsPools[1:2,]
dfPowellTiersAsPools$PowellLowerVol <- NULL
#Work on the equalization levels
dfPowellEqLevelsAsPools <- dfPowellEqLevelsFilt
colnames(dfPowellEqLevelsAsPools) <- c("Year","variable","stor_maf","MeadBeg","MeadEnd")
dfPowellEqLevelsAsPools$value <- 1000000*dfPowellEqLevelsAsPools$stor_maf
dfPowellEqLevelsAsPools$Reservoir <- "Powell"
#drop the three uneeded columns
dfPowellEqLevelsAsPools <- subset(dfPowellEqLevelsAsPools,select = -c(Year,MeadBeg,MeadEnd))
dfPowellTiersAsPools <- rbind(dfPowellTiersAsPools,dfPowellEqLevelsAsPools)
dfPowellTiersAsPools$level <- interp1(xi = dfPowellTiersAsPools$value,x=dfPowellElevStor$`Live Storage (ac-ft)`,y=dfPowellElevStor$`Elevation (ft)`, method="linear")
dfPowellTiersAsPools$month <- 1
dfPowellAllPools <- rbind(dfPowellVals,dfPowellTiersAsPools) %>% filter(month == 1)
cPowellRows <- c(2,4,7,9,12,13,14,15,16)
cPowellVarNames <- dfPowellAllPools$variable[cPowellRows]
dfPowellPoolsPlot <- dfPowellAllPools %>% filter(variable %in% cPowellVarNames) %>% arrange(level)
dfPowellPoolsPlot$name <- as.character(dfPowellPoolsPlot$variable)
#Save the data to csv
write.csv(dfPowellAllPools,"dfPowellAllPools.csv")
#Rename a few of the variable labels
dfPowellPoolsPlot[1,c("name")] <- "Dead Pool"
dfPowellPoolsPlot[2,c("name")] <- "Minimum Power (CRSS)"
dfPowellPoolsPlot[8,c("name")] <- "Flood Pool (Nov 1 to Jan 31)"
cPowellVarNames <- dfPowellPoolsPlot$name
#Create the y-axis tick label from the level and variable
dfPowellPoolsPlot$label <- paste(round(dfPowellPoolsPlot$level,0),'-',dfPowellPoolsPlot$name)
dfPowellPoolsMonthly <- dfPowellPoolsPlot %>% filter(name %in% cPowellVarNames) %>% arrange(-level)
dfPowellPoolsMonthly$EndMonth <- 12
dfPowellPoolsMonthlyMelt <- melt(dfPowellPoolsMonthly[,c("Reservoir","name","level","stor_maf","month","EndMonth")],id.vars = c("Reservoir","name","level","stor_maf"))
dfPowellPoolsMonthlyMelt$Month <- dfPowellPoolsMonthlyMelt$value
dfPowellPoolsMonthlyMelt <- dfPowellPoolsMonthlyMelt[,-c(5,6)]
dfPlotData <- dfPowellPoolsMonthlyMelt %>% arrange(-level,Month)
#Remove the Flood pool entry
dfPlotData2 <- dfPlotData %>% filter(name != dfPowellPoolsPlot[8,c("name")]) %>% arrange(-level)
ggplot() +
geom_line(data=dfPlotData2,aes(x=Month,y=stor_maf, color = name), size=2) +
scale_color_manual(values = palBlues[9:-1:2], breaks=cPowellVarNames) +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#scale_fill_manual(values = palBlues[7:-1:2]) +
geom_line(data=dfReservedFlood,aes(x=month_num, y=Powell_flood_stor, group = 1), size=2) +
#Label the levels within the equalization tiers
#geom_text(data=dfReleases, aes( x = MidPowell, y = MidMead, label = Release), angle = 0, size = 6) +
#Create secondary axes for Lake Levels
# Can't figure out why dfMeadTiers$Volume does not work!!!! Hard coding ...
#ylim(0,dfPlotData[1,c("stor_maf")]+1) +
#scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = LevelsAsTicks$stor_maf, labels = round(LevelsAsTicks$level,1))) +
scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Elevation (feet)", breaks = dfPowellPoolsPlot$stor_maf, labels = dfPowellPoolsPlot$label)) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
scale_x_continuous(breaks=cMonths, labels= cMonthsLabels) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Active Storage (MAF)", fill = "Pool") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18), legend.position = "none")
ggsave("PowellPools.png", width=9, height = 6.5, units="in")
### DER January 31, 2020 - Plot Reservoir Storage over time
### Mead, Powell, All onn same plot including total system storage
##### #5. Plot historical MEAD Pool Levels/Volumes over time
# Select the pools
dStartDate <- min(dfMeadHist$BeginOfMon)
dEndDate <- max(dfMeadHist$BeginOfMon)
cMeadVarNames <- c("Dead Pool", "SNWA Intake #1", "ISG trigger", "DCP trigger", "Live Capacity")
dfMeadPoolsMonthly <- dfMeadPoolsPlot %>% filter(name %in% cMeadVarNames) %>% arrange(-level)
dfMeadPoolsMonthly$month <- dStartDate
dfMeadPoolsMonthly$EndMonth <- dEndDate
dfMeadPoolsMonthlyMelt <- melt(dfMeadPoolsMonthly[,c("Reservoir","name","level","stor_maf","month","EndMonth")],id.vars = c("Reservoir","name","level","stor_maf"))
dfMeadPoolsMonthlyMelt$Month <- dfMeadPoolsMonthlyMelt$value
dfMeadPoolsMonthlyMelt <- dfMeadPoolsMonthlyMelt[,-c(5,6)]
dfPlotData <- dfMeadPoolsMonthlyMelt %>% arrange(-level,Month)
# Calculate new flood pools as a function of empty upstream storage
MaxMeadFloodPool <- max(dfReservedFlood$Mead_flood_stor)
cFillContours <- c(1,2,3)
cFillNames <- c("one","two","three","four")
nRowsPools <- nrow(dfReservedFlood)
dfFloodPools <- as.data.frame(dfReservedFlood[,c("month_num")])
dfFloodPools$'0' <- dfReservedFlood$Mead_flood_stor
dfFloodPools$'1' <- 0
dfFloodPools$'2' <- 0
dfFloodPools$'3' <- 0
for (contour in cFillContours) {
#Credit the empty upstream storage
dfFloodPools[,contour+2] <- dfReservedFlood$Mead_flood_stor + cFillContours[contour]
#Maintain a minimum flood pool
for (iRow in  (1:nrow(dfFloodPools))) {
dfFloodPools[iRow,contour+2] <- min(dfFloodPools[iRow,contour+2], MaxMeadFloodPool)
}
}
#Melt the contour data
dfFloodPoolsMelt <- melt(dfFloodPools,id.vars = c("month_num"))
#Adjust the right level ticks
dfMeadPoolsPlot2 <- dfMeadPoolsPlot
dfMeadPoolsPlot2[9,8] <- "1192 - Max. Req. Flood Pool"
dfMeadPoolsPlot2[10,8] <- "1218 - Min. Req. Flood Pool"
#Remove 1083 minimum power pool
dfMeadPoolsPlot2 <- dfMeadPoolsPlot2[c(seq(1,5),seq(7,11)),]
#Create the month ticks
cMonths <- 1:12
cMonthsLabels <- month.abb[cMonths]
ggplot() +
#Zone levels
geom_line(data=dfPlotData,aes(x=Month,y=stor_maf, group = as.factor(level), color = as.factor(level)), size=1.25) +
#Mead storage
geom_line(data=dfMeadHist,aes(x=BeginOfMon,y=Stor/1e6), size=2) +
scale_color_manual(values = palBlues[seq(5,10)]) +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#scale_fill_manual(values = palBlues[7:-1:2]) +
#Flood pools as a function of upstream storage
#geom_line(data=dfFloodPoolsMelt,aes(x=month_num, y=value, group = variable), size=1) +
#Label the flood pool contours of empty upstream storage
#geom_label(data=dfFloodPoolsMelt %>% filter(month_num %in% c(3,11)), aes( x = month_num, y = value, label = variable, fontface="bold"), size=5, angle = 0) +
#geom_label(aes( x = 7, y = 23, label = "[MAF of empty upstream storage]", fontface="bold"), label.size = 0, size=5, angle = 0) +
scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Elevation (feet)", breaks = dfMeadPoolsPlot2$stor_maf, labels = dfMeadPoolsPlot2$label)) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Mead Active Storage (MAF)", fill = "Pool") +
theme(text = element_text(size=20), legend.title=element_blank(),
legend.text=element_text(size=18), legend.position = "none",
axis.text.x = element_text(size=18))
ggsave("MeadTimeSeries.png", width=9, height = 6.5, units="in")
##### #6. Plot POWELL storage over time
# Prepare data for Lower and Mid equalization tiers
dfPowellTiersAsPools <- dfPowellTiers[,c("Tier","PowellLowerVol")]
colnames(dfPowellTiersAsPools) <- c("variable","PowellLowerVol")
dfPowellTiersAsPools$stor_maf <- 0;
dfPowellTiersAsPools <- mutate(dfPowellTiersAsPools, stor_maf = lead(PowellLowerVol))
dfPowellTiersAsPools$Reservoir <- 'Powell'
dfPowellTiersAsPools$value <- dfPowellTiersAsPools$stor_maf*1000000
dfPowellTiersAsPools <- dfPowellTiersAsPools[1:2,]
dfPowellTiersAsPools$PowellLowerVol <- NULL
#Work on the equalization levels
dfPowellEqLevelsAsPools <- dfPowellEqLevelsFilt
colnames(dfPowellEqLevelsAsPools) <- c("Year","variable","stor_maf","MeadBeg","MeadEnd")
dfPowellEqLevelsAsPools$value <- 1000000*dfPowellEqLevelsAsPools$stor_maf
dfPowellEqLevelsAsPools$Reservoir <- "Powell"
#drop the three uneeded columns
dfPowellEqLevelsAsPools <- subset(dfPowellEqLevelsAsPools,select = -c(Year,MeadBeg,MeadEnd))
dfPowellTiersAsPools <- rbind(dfPowellTiersAsPools,dfPowellEqLevelsAsPools)
dfPowellTiersAsPools$level <- interp1(xi = dfPowellTiersAsPools$value,x=dfPowellElevStor$`Live Storage (ac-ft)`,y=dfPowellElevStor$`Elevation (ft)`, method="linear")
dfPowellTiersAsPools$month <- 1
dfPowellAllPools <- rbind(dfPowellVals,dfPowellTiersAsPools) %>% filter(month == 1)
cPowellRows <- c(2,4,7,9,12,13,14,15,16)
cPowellVarNames <- dfPowellAllPools$variable[cPowellRows]
dfPowellPoolsPlot <- dfPowellAllPools %>% filter(variable %in% cPowellVarNames) %>% arrange(level)
dfPowellPoolsPlot$name <- as.character(dfPowellPoolsPlot$variable)
#Rename a few of the variable labels
dfPowellPoolsPlot[1,c("name")] <- "Dead Pool"
dfPowellPoolsPlot[2,c("name")] <- "Minimum Power (CRSS)"
dfPowellPoolsPlot[8,c("name")] <- "Flood Pool (Nov 1 to Jan 31)"
cPowellVarNames <- dfPowellPoolsPlot$name
#Create the y-axis tick label from the level and variable
dfPowellPoolsPlot$label <- paste(round(dfPowellPoolsPlot$level,0),'-',dfPowellPoolsPlot$name)
dfPowellPoolsMonthly <- dfPowellPoolsPlot %>% filter(name %in% cPowellVarNames) %>% arrange(-level)
dfPowellPoolsMonthly$EndMonth <- 12
dfPowellPoolsMonthlyMelt <- melt(dfPowellPoolsMonthly[,c("Reservoir","name","level","stor_maf","month","EndMonth")],id.vars = c("Reservoir","name","level","stor_maf"))
dfPowellPoolsMonthlyMelt$Month <- dfPowellPoolsMonthlyMelt$value
dfPowellPoolsMonthlyMelt <- dfPowellPoolsMonthlyMelt[,-c(5,6)]
dfPlotData2 <- dfPowellPoolsMonthlyMelt %>% arrange(-level,Month)
#Remove the Flood pool entry
dfPlotData2 <- dfPlotData2 %>% filter(name != dfPowellPoolsPlot[8,c("name")]) %>% arrange(-level)
#Add Full Dates
dStartDate <- min(dfJointStorage$DateAsValue)
dfPlotData2$Dates <- rep(c(dStartDate,dEndDate),times=nrow(dfPlotData2)/2)
ggplot() +
#Powell Zones
geom_line(data=dfPlotData2,aes(x=Dates,y=stor_maf, color = name), size=1.25) +
#Powell storage
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=PowellStorage), size=2) +
scale_color_manual(values = palBlues[9:-1:2], breaks=cPowellVarNames) +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
scale_y_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25),  sec.axis = sec_axis(~. +0, name = "Elevation (feet)", breaks = dfPowellPoolsPlot$stor_maf, labels = dfPowellPoolsPlot$label)) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powell Active Storage (MAF)", fill = "Pool") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18), legend.position = "none")
ggsave("PowellStorageTime.png", width=9, height = 6.5, units="in")
#################################################
#### COMBINED POWELL AND MEAD STORAGE OVER TIME
#################################################
# Combined, Powell, and Mead on one plot
ggplot() +
#Powell storage
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=PowellStorage, color="Powell"), size=2) +
#Mead Storage
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage, color="Mead"), size=2) +
#Combined Storage
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2) +
scale_color_manual(values = c("purple","red","blue"), breaks=c("Combined", "Powell", "Mead")) +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
scale_y_continuous(breaks = seq(0,50,by=10),labels=seq(0,50,by=10)) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Active Storage (MAF)", color = "Reservoir") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
### Combined plot for proposal
## Calculate the Protection elevation
dfProtectLevel <- data.frame(Reservoir = c("Powell", "Mead"), Elevation = c(3525, 1020))
#Interpolate storage from elevation
dfProtectLevel$Volume[1] <- interpNA(xi = dfProtectLevel$Elevation[1], x= dfPowellElevStor$`Elevation (ft)`, y=dfPowellElevStor$`Live Storage (ac-ft)`)
dfProtectLevel$Volume[2] <- interpNA(xi = dfProtectLevel$Elevation[2], x= dfMeadElevStor$`Elevation (ft)`, y=dfMeadElevStor$`Live Storage (ac-ft)`)
nProtectCombined <- sum(dfProtectLevel$Volume)/1e6
nCapacityCombined <- (dfMaxStor[1,2] + dfMaxStor[2,2])
nLastVolumeCombined <- dfJointStorage$PowellStorage[629] + dfJointStorage$MeadStorage[629]
#Data frame of key dates
dfKeyDates <- data.frame(Date = as.Date(c("2007-01-01", "2026-01-01")), Label = c("Interim\nGuidelines", "Guidelines\nExpire"))
#Data frame of key elevations
dfKeyVolumes <- data.frame(Volume = c(nProtectCombined, nCapacityCombined), Label = c("Protect","Combined\nCapacities"))
#Data frame of key traces
dfKeyTraceLabels <- data.frame(Label = c("Protect Mindset", "Available Water", "Deficit Mindset"),
Volume = c(nProtectCombined/2, 16, 40), xPosition = rep(2007 + (2021 - 2007)/2,3))
#Data frame of end arrows
nArrowOffset <- 4
dfEndArrows <- data.frame(Label = c("Recover?", "Stabilize?", "Draw down?"), Ystart = rep(nLastVolumeCombined,3),
Xstart = as.Date(rep("2022-01-01",3)), Xend = as.Date(rep("2025-01-01",3)),
Yend = c(nLastVolumeCombined + nArrowOffset, nLastVolumeCombined, nLastVolumeCombined - nArrowOffset),
Angle = c(20,0,-20), Yoffset = c(0.1, 0, -0.1))
#Calculate the mid date
dfEndArrows$MidDate <- dfEndArrows$Xstart + floor((dfEndArrows$Xend - dfEndArrows$Xstart)/2)
#New data frame for area
dfJointStorageStack <- dfJointStorage
dfJointStorageStack$Protect <- nProtectCombined
dfJointStorageStack$Volume <- dfJointStorage$PowellStorage + dfJointStorage$MeadStorage - dfJointStorageStack$Protect
dfJointStorageStack$Capacity <- nCapacityCombined - dfJointStorageStack$Volume - dfJointStorageStack$Protect
#Melt the data
dfJointStorageStackMelt <- melt(dfJointStorageStack, id.vars = c("DateAsValue"), measure.vars = c("Protect","Volume", "Capacity"))
#Specify the order of the variables
dfJointStorageStackMelt$variable <- factor(dfJointStorageStackMelt$variable, levels=c("Capacity","Volume", "Protect"))
#Get the color palettes
#Get the blue color bar
pBlues <- brewer.pal(9,"Blues")
pReds <- brewer.pal(9,"Reds")
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec_axis(~. /nCapacityCombined*100, name = "Percent of Combined Capacity", breaks = seq(0,100, by=20))) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec_axis(~ ./nCapacityCombined*100, name = "Percent of Combined Capacity", breaks = seq(0,100, by=20))) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec_axis(~ ./nCapacityCombined*100)) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec.axis = sec_axis(~ . /nCapacityCombined*100)) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec.axis = sec_axis(~ . /nCapacityCombined*100, name = "Percent of Combined Capacity", breaks = seq(0,100,by=25), labels = sprintf("%%d", seq(0,100,by=25)))) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
sprintf("%%d", seq(0,100,by=25))
sprintf("%%i", seq(0,100,by=25))
sprintf("%f%", seq(0,100,by=25))
sprintf("%d", seq(0,100,by=25))
sprintf("%d%%", seq(0,100,by=25))
ggplot() +
#Combined Storage
#As area
geom_area(data=dfJointStorageStackMelt, aes(x=DateAsValue, y=value, fill=variable, group=variable)) +
#As line
geom_line(data=dfJointStorage,aes(x=DateAsValue,y=MeadStorage+PowellStorage, color="Combined"), size=2, color = "Black") +
#geom_area(data=dfPlotData,aes(x=month,y=stor_maf, fill = variable), position='stack') +
#lines for max capacity and protect elevation
geom_hline(data=dfKeyVolumes, aes(yintercept = Volume), linetype="longdash", size=1) +
#lines for Interim Guidelines and Expiry
geom_vline(data=dfKeyDates, aes(xintercept = Date), linetype = "dashed", size=1, color = pReds[9]) +
#Labels for the areas
geom_text(data=dfKeyTraceLabels, aes(x=as.Date(sprintf("%d-01-01",xPosition)), y=Volume, label=as.character(Label)), size=6, fontface="bold") +
#Label what is next
#geom_text(data = dfEndArrows %>% filter(Label == "Recover?"), aes(x= MidDate, y = Ystart, label = "Recover?\nStabilize?\nDraw down?"), size = 5, color = "Black") +
#Arrow annotations at end of time
#geom_segment(data = dfEndArrows, aes(x=Xstart, xend=Xend, y=Ystart, yend = Yend), color = "Black", size = 1.5, arrow = arrow()) +
#Label the arrows
geom_text(data = dfEndArrows, aes(x = Xstart, y = (Ystart+Yend)/2 + Yoffset, label = Label, angle = Angle), size = 5, color = "Black", hjust = 0) +
#geom_segment(aes(x=as.Date("2022-01-01"), xend=as.Date("2025-01-01"), y=12, yend = 14, colour = palBlues[7], arrow = arrow())) +
#Scales
scale_x_date(limits= c(as.Date("1990-01-01"), as.Date("2026-01-01")), sec.axis = sec_axis(~. +0, name = "", breaks = dfKeyDates$Date, labels = as.character(dfKeyDates$Label))) +
#scale_y_continuous(limits = c(0,NA)) +
# secondary axis is not working
# scale_y_continuous(limits = c(0,NA), sec_axis(~. +0, name = "", breaks = dfKeyVolumes$Volume, labels = dfKeyVolumes$Volume)) +
#Secondary axis as percent
scale_y_continuous(limits = c(0,NA), sec.axis = sec_axis(~ . /nCapacityCombined*100, name = "Percent of Combined Capacity", breaks = seq(0,100,by=25), labels = sprintf("%d%%", seq(0,100,by=25)))) +
scale_fill_manual(values=c(pReds[3], pBlues[5], pBlues[7])) +
#    scale_y_continuous(breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]),labels=c(0,5.98,9.6,12.2,dfMaxStor[2,2]),  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = c(0,5.98,9.6,12.2,dfMaxStor[2,2]), labels = c(895,1025,1075,1105,1218.8))) +
#scale_x_discrete(breaks=cMonths, labels= cMonthsLabels) +
#scale_x_continuous(breaks=seq(1960,2020,by=10), labels= seq(1960,2020,by=10)) +
#scale_fill_manual(breaks=c(1:6),values = palBlues[2:7]) + #,labels = variable) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Combined Active Storage\n(MAF)", color = "") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.position ="none")
#theme(text = element_text(size=20), legend.text=element_text(size=16)
