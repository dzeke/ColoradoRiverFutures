#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed Temperature"), color = "Blue", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid")) +
scale_shape_manual(values = c("circle")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Blue", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid")) +
scale_shape_manual(values = c("circle")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Blue", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid","solid")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Blue", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid","solid")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot, MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh, aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Blue", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid","solid")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75)
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Red", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Blue", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid","solid")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed"), color = "Transformed", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed"), color = "Observed", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
#scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
#scale_linetype_manual(values = c("solid","solid")) +
scale_color_manual(values = c("Red","Blue")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T), shape ="Transformed", color = "Transformed", size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T), shape ="Observed", color = "Observed", size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
#scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
#scale_linetype_manual(values = c("solid","solid")) +
scale_color_manual(values = c("Red","Blue")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed", color = "Transformed"), size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed", color = "Observed"), size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
#scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
#scale_linetype_manual(values = c("solid","solid")) +
scale_color_manual(values = c("Red","Blue")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed", color = "Transformed"), size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed", color = "Observed"), size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
#scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
#scale_linetype_manual(values = c("solid","solid")) +
scale_color_manual(values = c("Red","Blue")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", shape="Data Source") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggplot() +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
# Transformed temperature - move water surface to depth feet above river outlets
geom_point(data = dfPowellTempLevelsPlot %>% filter(ElevAbvDeadPool <= 3600), aes(y = ElevAbvDeadPool, x = T, shape ="Transformed", color = "Transformed"), size=0.75) +
#Observed water surface and Wahweap river outlet temperature
geom_point(data = dfPowellTempLevelsPlot %>% filter(MeasLevel >= dfPowellZonesShort[8,2], MeasLevel <= dfPowellZonesShort[8,2] + nElevThresh), aes(y = Elevation..feet., x = T, shape ="Observed", color = "Observed"), size=0.75) +
# geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature\nat turbine elev."), color = "Purple", size=0.75) +
#scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
#scale_linetype_manual(values = c("solid","solid")) +
scale_color_manual(values = c("Blue","Red")) +
scale_shape_manual(values = c("circle","square")) +
labs(y="Water Surface Elevation (feet)", x="Wahweap Temperature at 3,370 feet (oC)", color="Data Source", shape="Data Source") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
FindElevationRangeForTemperatureRiverOutlet <- function(dfProfile, cTemps, TempTolerance) {
#Find the range of reservoir water surface elevations for specified temperatures in cTemps within TempTolerance of the specified temperature.
#This is temperature at Wahweap at the River outlet elevation
#Use the profile data sets
#Searches the data in the Temperature range {cTemps[i], to cTemps[i] + TempTolerance}
#cTemps are ascending
#Test values
# cTemps <- 15
# dfProfile <- dfPowellTempLevelsPlot
# TempTolerance <- 0.5
# i <- 1
#Find water surface elevation range for each temperature criteria
for (i in (1:length(cTemps))) {
Temperature <- cTemps[i]
paste(i, Temperature, TempTolerance)
dfRangeProfile <- dfProfile %>%  filter(T >= Temperature, T <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAbvDeadPool), maxElevation = max(ElevAvbDeadPool))
#Add values for missing months. At and above turbine elevation, temperature will be value
cMonthsMiss <- which(!(seq(1,12,by=1) %in% dfRangeProfile$Month.x))
dfMissMonths <- data.frame(Month.x = cMonthsMiss, Temperature = Temperature, minElevation = 3370, maxElevation = 3370)
#Bind to range datafram
dfRangeProfile <- rbind(as.data.frame(dfRangeProfile), dfMissMonths)
#Store results for elevation
if (i==1) { # new dataframe
dfRange <- dfRangeProfile
} else { #Combine with results for prior elevations
dfRange <- rbind(dfRange, dfRangeProfile)
}
}
#Calculate the temperature range
dfRange$Range <- dfRange$maxElevation - dfRange$minElevation
#Order the data frame by months
dfRange <- dfRange[order(dfRange$Month.x, dfRange$Temperature),]
return(dfRange)
}
dfTestDeadPoolElev <- FindElevationRangeForTemperatureRiverOutlet(dfPowellTempLevelsPlot, cTempsBreak, 1.0)
dfProfile <- dfPowellTempLevelsPlot
TempTolerance <- 1
i <- 1
Temperature <- cTemps[i]
cTemps <- cTempsBreak
dfProfile <- dfPowellTempLevelsPlot
TempTolerance <- 1
i <- 1
Temperature <- cTemps[i]
paste(i, Temperature, TempTolerance)
dfRangeProfile <- dfProfile %>%  filter(T >= Temperature, T <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAbvDeadPool), maxElevation = max(ElevAvbDeadPool))
sapply(dfProfile,"class")
dfRangeProfile <- dfProfile %>%  filter(T >= Temperature, T <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAbvDeadPool))
dfRangeProfile <- dfProfile %>%  filter(T >= Temperature, T <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAbvDeadPool), maxElevation = max(ElevAbvDeadPool))
cMonthsMiss <- which(!(seq(1,12,by=1) %in% dfRangeProfile$Month.x))
dfMissMonths <- data.frame(Month.x = cMonthsMiss, Temperature = Temperature, minElevation = 3370, maxElevation = 3370)
dfRangeProfile <- rbind(as.data.frame(dfRangeProfile), dfMissMonths)
View(dfRangeProfile)
FindElevationRangeForTemperatureRiverOutlet <- function(dfProfile, cTemps, TempTolerance) {
#Find the range of reservoir water surface elevations for specified temperatures in cTemps within TempTolerance of the specified temperature.
#This is temperature at Wahweap at the River outlet elevation
#Use the profile data sets
#Searches the data in the Temperature range {cTemps[i], to cTemps[i] + TempTolerance}
#cTemps are ascending
#Test values
# cTemps <- cTempsBreak
# dfProfile <- dfPowellTempLevelsPlot
# TempTolerance <- 1
# i <- 1
#Find water surface elevation range for each temperature criteria
for (i in (1:length(cTemps))) {
Temperature <- cTemps[i]
paste(i, Temperature, TempTolerance)
dfRangeProfile <- dfProfile %>%  filter(T >= Temperature, T <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAbvDeadPool), maxElevation = max(ElevAbvDeadPool))
#Add values for missing months. At and above turbine elevation, temperature will be value
cMonthsMiss <- which(!(seq(1,12,by=1) %in% dfRangeProfile$Month.x))
dfMissMonths <- data.frame(Month.x = cMonthsMiss, Temperature = Temperature, minElevation = 3370, maxElevation = 3370)
#Bind to range datafram
dfRangeProfile <- rbind(as.data.frame(dfRangeProfile), dfMissMonths)
#Store results for elevation
if (i==1) { # new dataframe
dfRange <- dfRangeProfile
} else { #Combine with results for prior elevations
dfRange <- rbind(dfRange, dfRangeProfile)
}
}
#Calculate the temperature range
dfRange$Range <- dfRange$maxElevation - dfRange$minElevation
#Order the data frame by months
dfRange <- dfRange[order(dfRange$Month.x, dfRange$Temperature),]
return(dfRange)
}
dfTestDeadPoolElev <- FindElevationRangeForTemperatureRiverOutlet(dfPowellTempLevelsPlot, cTempsBreak, 1.0)
View(dfTestDeadPoolElev)
dfTestDeadPoolElev <- dfTestDeadPoolElev[order(dfTestDeadPoolElev$Month.x, dfTestDeadPoolElev$Temperature),]
dfTestDeadPoolElev$maxElevNextT <- dplyr::lag(dfTestDeadPoolElev$maxElevation)
# Filter for elevation values for each temperature block
dfTestElevDeadPoolBar <- (data.frame(Month.x = seq(1,12,by=1), TempCategory = "Base" , ElevationAdd = 3490)) # Base entry
dfTestElevDeadPoolBar2 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[3], ElevationAdd = ifelse(minElevation > 3490, minElevation, 3490) - 3490) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar3 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[2], ElevationAdd = maxElevNextT - minElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar4 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[1]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[1], ElevationAdd = 3700 - maxElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar <- as.data.frame(rbind(dfTestElevDeadPoolBar, dfTestElevDeadPoolBar2, dfTestElevDeadPoolBar3, dfTestElevDeadPoolBar4))
#Set transparency field. Base is zero. Everything else is one.
dfTestElevDeadPoolBar$Alpha <- ifelse(dfTestElevDeadPoolBar$TempCategory == cCategories[4],0,1)
#Order the bars
#dfTestElevBar$Month.x <- factor(dfTestElevBar$Month.x, levels = seq(1,12,by=1))
dfTestElevDeadPoolBar$TempCategory <- factor(dfTestElevDeadPoolBar$TempCategory, levels = cCategories )
dfTestElevDeadPoolBar <- dfTestElevDeadPoolBar[order(dfTestElevDeadPoolBar$Month.x, dfTestElevDeadPoolBar$TempCategory),]
ggplot(data=dfTestElevDeadPoolBar) +  #[order(dfTestElevBar$TempCategory, decreasing = T),]
#Range of elevation for specified water temperature
geom_bar(aes(x=Month.x, y=ElevationAdd, fill=TempCategory, group = TempCategory, alpha = Alpha), stat = "identity") +
#geom_ribbon(aes(x=Month.x, ymin= minElevation, ymax=maxElevation, fill=as.factor(Temperature))) +
scale_fill_manual(values = c("blue", "pink","red","white"), breaks = cCategories[1:3], labels = cCategories[1:3]) +
#scale_color_manual(values = c("blue","red")) +
labs(y="Water Surface Elevation (feet)", x="Month", fill="Wahweep Temperature (oC)\nat Dead Pool Elev.", alpha = "", linetype="", shape="") +
coord_cartesian(ylim = c(3370,3700)) +
scale_y_continuous(breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
scale_x_continuous(limits = c(0.5,12.5), breaks = seq(1,12,by=1)) +
scale_alpha(guide = 'none') +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
dfTestElevDeadPoolBar <- (data.frame(Month.x = seq(1,12,by=1), TempCategory = "Base" , ElevationAdd = 3370)) # Base entry
dfTestElevDeadPoolBar2 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[3], ElevationAdd = ifelse(minElevation > 3370, minElevation, 3370) - 3370) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar3 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[2], ElevationAdd = maxElevNextT - minElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar4 <- as.data.frame(dfTestDeadPoolElev %>% filter(Temperature == cTempsBreak[1]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[1], ElevationAdd = 3700 - maxElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevDeadPoolBar <- as.data.frame(rbind(dfTestElevDeadPoolBar, dfTestElevDeadPoolBar2, dfTestElevDeadPoolBar3, dfTestElevDeadPoolBar4))
#Set transparency field. Base is zero. Everything else is one.
dfTestElevDeadPoolBar$Alpha <- ifelse(dfTestElevDeadPoolBar$TempCategory == cCategories[4],0,1)
#Order the bars
#dfTestElevBar$Month.x <- factor(dfTestElevBar$Month.x, levels = seq(1,12,by=1))
dfTestElevDeadPoolBar$TempCategory <- factor(dfTestElevDeadPoolBar$TempCategory, levels = cCategories )
dfTestElevDeadPoolBar <- dfTestElevDeadPoolBar[order(dfTestElevDeadPoolBar$Month.x, dfTestElevDeadPoolBar$TempCategory),]
ggplot(data=dfTestElevDeadPoolBar) +  #[order(dfTestElevBar$TempCategory, decreasing = T),]
#Range of elevation for specified water temperature
geom_bar(aes(x=Month.x, y=ElevationAdd, fill=TempCategory, group = TempCategory, alpha = Alpha), stat = "identity") +
#geom_ribbon(aes(x=Month.x, ymin= minElevation, ymax=maxElevation, fill=as.factor(Temperature))) +
scale_fill_manual(values = c("blue", "pink","red","white"), breaks = cCategories[1:3], labels = cCategories[1:3]) +
#scale_color_manual(values = c("blue","red")) +
labs(y="Water Surface Elevation (feet)", x="Month", fill="Wahweep Temperature (oC)\nat Dead Pool Elev.", alpha = "", linetype="", shape="") +
coord_cartesian(ylim = c(3370,3700)) +
scale_y_continuous(breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
scale_x_continuous(limits = c(0.5,12.5), breaks = seq(1,12,by=1)) +
scale_alpha(guide = 'none') +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
ggsave("ElevationRangesForTempTargets-RiverOutlets.png", width=9, height = 6.5, units="in")
dfPowellTempLevelsPlot$TurbRelease <- dfPowellTempLevelsPlot$T -
ifelse(dfPowellTempLevelsPlot$T < 11,0,
ifelse(dfPowellTempLevelsPlot$T < 13, 0.5,
ifelse(dfPowellTempLevelsPlot$T < 15, 1, 2)))
ggplot(data=dfPowellReleaseElev %>% filter(Day %in% seq(1,31, by=1)) %>% arrange(DateClean)) +
#geom_line(aes(x=Day,y=avgDay), color="black") +
#Points represent transformed temperature profile reading. For a specific depth below the water surface,
#we calculate the elevation that would put the depth at the turbine elevation
#geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = T, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
#Version with Wahweap-Turbine release temperature correction
geom_point(data = dfPowellTempLevelsPlot %>% filter(Depth*dMetersToFeet <= 3600 - dfPowellZonesShort[6,2]), aes(y = ElevAvbPenstock, x = TurbRelease, shape ="Wahweap temperature profile:\nshifted so water surface is\ndepth feet above turbine elev."), color = "Red", size=0.75) +
#Error bar on release data - color by water surface
geom_errorbar(aes(y=WaterSurface, xmin= minDay, xmax=maxDay, color = Year.x), size=1) +
geom_line(data = dfTempElevationModelCalc %>% filter(Elevation > dfPowellZonesShort[6,2] - 10), aes(x=Temperature, y=Elevation, linetype="Spreadsheet model"), color = "Black", size=1.25) +
scale_color_continuous(low=palBlues[2],high=palBlues[9], na.value="White", guide = "colorbar", aesthetics="color") +
scale_linetype_manual(values = c("solid")) +
scale_shape_manual(values = c("circle")) +
labs(y="Water Surface Elevation (feet)", x="Turbine Release Temperature (oC)", color="Observed release (Year)", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
facet_wrap(~Month.x) +
scale_y_continuous(limits = c(3370,3700), breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
xlim(7,30) +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16)) #,
#legend.key = element_blank())
ggsave("CompareReleaseElevationMonth.png", width=9, height = 6.5, units="in")
FindTempRangeForElevation <- function(dfObserved, dfProfile, cElevations) {
#Find the range of release temperature for between each specified elevation range in cElevations.
#Use both observed and profile data sets
#Searches the data in the Elevation range {cElevation[i], to cElevation[i-1]}
#cElevations are ascending
#Test values
#cElevations <- seq(3560,3565,by=5)
#dfObserved <- dfPowellReleaseElev
#dfProfile <- dfPowellTempLevelsPlot
#i <- 1
cElevationDiff <- diff(cElevations)
#Duplicate the last value
cElevationDiff <- c(cElevationDiff,cElevationDiff[length(cElevationDiff)])
#Find temperature range for each data set
for (i in (1:length(cElevations))) {
Elevation <- cElevations[i]
ElevationTolerance <- cElevationDiff[i]
paste(i, Elevation, ElevationTolerance)
dfRangeObs <- dfObserved %>% filter(WaterSurface >= Elevation, WaterSurface <= Elevation+ElevationTolerance) %>% group_by(Month.x) %>% summarize(SurfaceElevation = Elevation, minTemp = min(minDay), maxTemp = max(maxDay))
dfRangeProfile <- dfProfile %>%  filter(ElevAvbPenstock >= Elevation, ElevAvbPenstock <= Elevation + ElevationTolerance) %>% group_by(Month.x) %>% summarize(SurfaceElevation = Elevation, minTemp = min(TurbRelease), maxTemp = max(TurbRelease))
#Combine (bind) the datasets
dfRangeComb <- rbind(dfRangeObs,dfRangeProfile)
#Find the range from the values
dfRangeCurrElev <- dfRangeComb %>% group_by(Month.x,SurfaceElevation) %>% summarize(minTemp = min(minTemp), maxTemp = max(maxTemp))
#Store results for elevation
if (i==1) { # new dataframe
dfRange <- dfRangeCurrElev
} else { #Combine with results for prior elevations
dfRange <- rbind(dfRange, dfRangeCurrElev)
}
}
#Calculate the temperature range
dfRange$Range <- dfRange$maxTemp - dfRange$minTemp
return(dfRange)
}
FindElevationRangeForTemperature <- function(dfObserved, dfProfile, cTemps, TempTolerance) {
#Find the range of reservoir water surface elevations for specified temperatures in cTemps within TempTolerance of the specified temperature.
#Use both observed and profile data sets
#Searches the data in the Temperature range {cTemps[i], to cTemps[i] + TempTolerance}
#cTemps are ascending
#Test values
# cTemps <- 15
# dfObserved <- dfPowellReleaseElev
# dfProfile <- dfPowellTempLevelsPlot
# TempTolerance <- 0.5
# i <- 1
#Find water surface elevation range for each temperature criteria
for (i in (1:length(cTemps))) {
Temperature <- cTemps[i]
paste(i, Temperature, TempTolerance)
dfRangeObs <- dfObserved %>% filter(minDay >= Temperature, minDay <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(WaterSurface), maxElevation = max(WaterSurface))
dfRangeProfile <- dfProfile %>%  filter(TurbRelease >= Temperature, TurbRelease <= Temperature + TempTolerance) %>% group_by(Month.x) %>% summarize(Temperature = Temperature, minElevation = min(ElevAvbPenstock), maxElevation = max(ElevAvbPenstock))
#Combine (bind) the datasets
dfRangeComb <- rbind(dfRangeObs,dfRangeProfile)
#Find the range from the values
dfRangeCurrTemp <- dfRangeComb %>% group_by(Month.x,Temperature) %>% summarize(minElevation = min(minElevation), maxElevation = max(maxElevation))
#Add values for missing months. At and above turbine elevation, temperature will be value
cMonthsMiss <- which(!(seq(1,12,by=1) %in% dfRangeCurrTemp$Month.x))
dfMissMonths <- data.frame(Month.x = cMonthsMiss, Temperature = Temperature, minElevation = 3490, maxElevation = 3490)
#Bind to range datafram
dfRangeCurrTemp <- rbind(as.data.frame(dfRangeCurrTemp), dfMissMonths)
#Store results for elevation
if (i==1) { # new dataframe
dfRange <- dfRangeCurrTemp
} else { #Combine with results for prior elevations
dfRange <- rbind(dfRange, dfRangeCurrTemp)
}
}
#Calculate the temperature range
dfRange$Range <- dfRange$maxElevation - dfRange$minElevation
#Order the data frame by months
dfRange <- dfRange[order(dfRange$Month.x, dfRange$Temperature),]
return(dfRange)
}
dfTest <- FindTempRangeForElevation(dfPowellReleaseElev,dfPowellTempLevelsPlot, seq(3490,3690,by=5))
dfTestElev <- FindElevationRangeForTemperature(dfPowellReleaseElev,dfPowellTempLevelsPlot, cTempsBreak, 1.0)
dfTestElev <- dfTestElev[order(dfTestElev$Month.x, dfTestElev$Temperature),]
dfTestElev$maxElevNextT <- dplyr::lag(dfTestElev$maxElevation)
# Filter for elevation values for each temperature block
dfTestElevBar <- (data.frame(Month.x = seq(1,12,by=1), TempCategory = "Base" , ElevationAdd = 3490)) # Base entry
dfTestElevBar2 <- as.data.frame(dfTestElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[3], ElevationAdd = ifelse(minElevation > 3490, minElevation, 3490) - 3490) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevBar3 <- as.data.frame(dfTestElev %>% filter(Temperature == cTempsBreak[2]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[2], ElevationAdd = maxElevNextT - minElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevBar4 <- as.data.frame(dfTestElev %>% filter(Temperature == cTempsBreak[1]) %>% mutate(Month.x = Month.x, TempCategory = cCategories[1], ElevationAdd = 3700 - maxElevation) %>% select(Month.x, TempCategory, ElevationAdd))
dfTestElevBar <- as.data.frame(rbind(dfTestElevBar, dfTestElevBar2, dfTestElevBar3, dfTestElevBar4))
#Set transparency field. Base is zero. Everything else is one.
dfTestElevBar$Alpha <- ifelse(dfTestElevBar$TempCategory == cCategories[4],0,1)
#Order the bars
#dfTestElevBar$Month.x <- factor(dfTestElevBar$Month.x, levels = seq(1,12,by=1))
dfTestElevBar$TempCategory <- factor(dfTestElevBar$TempCategory, levels = cCategories )
dfTestElevBar <- dfTestElevBar[order(dfTestElevBar$Month.x, dfTestElevBar$TempCategory),]
ggplot(data=dfTestElevBar) +  #[order(dfTestElevBar$TempCategory, decreasing = T),]
#Range of elevation for specified water temperature
geom_bar(aes(x=Month.x, y=ElevationAdd, fill=TempCategory, group = TempCategory, alpha = Alpha), stat = "identity") +
#geom_ribbon(aes(x=Month.x, ymin= minElevation, ymax=maxElevation, fill=as.factor(Temperature))) +
scale_fill_manual(values = c("blue", "pink","red","white"), breaks = cCategories[1:3], labels = cCategories[1:3]) +
#scale_color_manual(values = c("blue","red")) +
labs(y="Water Surface Elevation (feet)", x="Month", fill="Turbine Release\nTemperature (oC)", alpha = "", linetype="", shape="") +
#labs(x="Temperature at Wahweap @ 3,490 ft (oC)", y="Turbine Release Temperature (oC)", color="") +
coord_cartesian(ylim = c(3370,3700)) +
scale_y_continuous(breaks = seq(3250,3711, by=50),labels=seq(3250,3711, by=50),  sec.axis = sec_axis(~. +0, name = "Active Storage\n(million acre-feet)", breaks = dfPowellZonesMinusTop$level_feet, labels = dfPowellZonesMinusTop$rightlabel )) +
scale_x_continuous(limits = c(0.5,12.5), breaks = seq(1,12,by=1)) +
scale_alpha(guide = 'none') +
#Vertical line at temperature breaks
#geom_vline(xintercept=c(15,18)) +
theme(text = element_text(size=18), legend.text=element_text(size=16))
ggsave("ElevationRangesForTempTargets-Turbine.png", width=9, height = 6.5, units="in")
